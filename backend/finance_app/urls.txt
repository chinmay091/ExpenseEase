from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static
from rest_framework.routers import DefaultRouter
from . import views  # Ensure views.py exists and has homepage & api_root
from backend.finance_app.views import CustomTokenObtainPairView, CustomTokenRefreshView
from backend.plaid.transactions_views import LiabilitiesView

urlpatterns = [
    # Root endpoints
    path('', views.homepage, name="homepage"),
    path('api/', views.api_root, name='api_root'),

    # Admin Panel
    path('admin/', admin.site.urls),

    # Plaid API Endpoints
    path('api/plaid/', include('backend.plaid.urls')),
    path('api/plaid/link/token/create/', views.create_link_token, name='create_link_token'),
    path('api/plaid/item/public_token/exchange/', views.exchange_public_token, name='exchange_public_token'),
    path('api/plaid/accounts/', views.fetch_accounts, name='fetch_accounts'),
    path('api/plaid/transactions/', views.fetch_transactions, name='fetch_transactions'),
    path('api/plaid/investments/', views.fetch_investments, name='fetch_investments'),
    path('api/plaid/liabilities/', LiabilitiesView.as_view(), name='liabilities'),
    path('api/plaid/statements/', views.fetch_statements, name='fetch_statements'),
    path('api/plaid/identity/', views.fetch_identity, name='fetch_identity'),
    path('api/plaid/recurring-transactions/', views.fetch_recurring_transactions, name='fetch_recurring_transactions'),
    path('api/plaid/fraud-detection/', views.signal_fraud_detection, name='signal_fraud_detection'),
    path('api/plaid/payment-initiation/', views.initiate_payment, name='initiate_payment'),
    path('api/plaid/asset-report/', views.fetch_asset_report, name='fetch_asset_report'),

    # ExpenseEase App Endpoints
    path('api/expenses/', include('backend.expenses.urls')),  # CRUD for expenses
    path('api/insights/', views.get_insights, name='get_insights'),
    path('api/fraud-alerts/', views.manage_fraud_alerts, name='manage_fraud_alerts'),
    path('api/news-feed/', views.get_news_feed, name='get_news_feed'),
    path('api/chatbot/', views.chatbot_response, name='chatbot_response'),

    # User Profile & Settings
    path('api/user/profile/', views.user_profile, name='user_profile'),
    path('api/user/notifications/', views.user_notifications, name='user_notifications'),
    path('api/user/preferences/', views.user_preferences, name='user_preferences'),

    # Authentication
    path('api/auth/login/', CustomTokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/auth/token/refresh/', CustomTokenRefreshView.as_view(), name='token_refresh'),
    path('api/auth/', include('rest_framework.urls')),
]

# Serve media files in development mode
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
